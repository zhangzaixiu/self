<?phpnamespace app\admin\controller;use app\admin\model\FrontendMessageCategoryModel;use app\admin\model\FrontendMessageModel;use think\Db;use think\Request;class FrontendMessageController extends  BaseController{    /**     * 列表页     * @return \think\response\Json|\think\response\View     */    public function index(){        $this->view->engine->layout(true);        $category = FrontendMessageCategoryModel::getSelectArray();        if(\think\facade\Request::isAjax()){            $data = array_filter(input('','','trim'));            $data= FrontendMessageModel::getList($data);            return $data;        }        return view('',['category'=>$category]);    }    /**     * 创建     * @return \think\response\Json|\think\response\View     */    public function create(){        $this->view->engine->layout(true);        $category = FrontendMessageCategoryModel::getSelectArray();        if(\think\facade\Request::isPost()){            try {                $data = input('post.','','trim');                $this->validate($data, 'FrontendMessage');                $banner = new FrontendMessageModel($data);                if(!$banner->save()){                    throw new \think\Exception('信息添加失败');                }                $result['msg'] = '信息添加成功';                $result['success'] = true;                $result['url'] = url('frontend_message/index');                return json($result);            } catch (\Exception $e) {                return json(['success' => false, 'msg' => $e->getMessage(), 'data' => []]);            }        }        return view('',['category'=>$category]);    }    /**     * 展示     * @return \think\response\Json|\think\response\View     */    public function show(){        $id = input('id');        try {            if(empty($id)){                throw new \think\Exception('错误请求');            }            $message = FrontendMessageModel::get($id);            if(empty($message)){                throw new \think\Exception('信息不存在');            }            return  view('',['data'=>$message]);        } catch (\Exception $e) {            return  view('layout/message',['msg'=>$e->getMessage()]);        }    }    /**     * 编辑     * @return \think\response\Json|\think\response\View     */    public function edit(){        if(Request::instance()->isPost()){            try {                Db::startTrans();                $id = input('id');                if(empty($id)){                    throw new \think\Exception('错误请求');                }                $data = input('','','trim');                if(isset($data['info'][$data['type']])){                    $data = $data + $data['info'][$data['type']];                }                unset($data['info']);                if( request()->module() == 'admin'){//总后台                    $data['source'] = 1;                }else{                    $data['source'] = 2;                }                $valiRes = $this->validate($data, 'EtprsMessage');                if ($valiRes !== true) {                    throw new \think\Exception($valiRes);                }                $result = saveData('EtprsMessage', $data);                if ($result['code'] == 0) {                    throw new \think\Exception('编辑失败' . $result['msg']);                }                $result['msg'] = '编辑成功';                $result['success'] = true;                Db::commit();                return json($result);            } catch (\Exception $e) {                Db::rollback();                c_Log($e);                return json(['success' => false, 'msg' => $e->getMessage(), 'data' => []]);            }        }    }//    /**//     * 下线//     * @return \think\response\Json//     *///    public function off()//    {//        try {//            //dump(input(''));exit;//            $id = input('id');//            if(empty($id)){//                throw new \think\Exception('错误请求');//            }////            //-me 20180814//            if (input('del')){//                $result = saveData('EtprsMessage', ['id'=>$id,'isDelete'=>1]);//            }else{//                $result = saveData('EtprsMessage', ['id'=>$id,'status'=>3]);//            }////            if ($result['code'] == 0) {//                throw new \think\Exception('操作失败');//            }//            return json(['code' => 1, 'msg' => '操作成功']);//        } catch (\Exception $e) {//            c_Log($e);//            return json(['code' => 0, 'msg' => $e->getMessage()]);//        }//    }    // 删除    public function delete()    {        try {            $id = input('id');            if(empty($id)){                throw new \think\Exception('错误请求');            }            $result = FrontendMessageModel::where(['id'=>$id])->delete();            if(!$result){                throw new \think\Exception('删除信息失败');            }            return json(['success' => 1, 'msg' => '删除成功']);        } catch (\Exception $e) {            return json(['success' => 0, 'msg' => $e->getMessage()]);        }    }}