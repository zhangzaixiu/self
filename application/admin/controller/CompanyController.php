<?phpnamespace app\admin\controller;use app\common\model\CompanyModel;use app\common\model\EnterCategoryModel;use think\Db;class CompanyController extends  BaseController{    /**     * 列表页     * @return \think\response\Json|\think\response\View     */    public function index(){        $this->view->engine->layout(true);        if(\think\facade\Request::isAjax()){            $data = array_filter(input('','','trim'));            $data=CompanyModel::getList($data);            return $data;        }        return view();    }    /**     * 添加     * @return \think\response\Json|\think\response\View     */    public function create(){        $this->view->engine->layout(true);        $category = EnterCategoryModel::getSelectArray();        if(\think\facade\Request::isPost()){            try {                Db::startTrans();                $data = input('','','trim');                $this->validate($data, 'Company.create');                $company = new CompanyModel($data);                if(!$company->save()){                    throw new \think\Exception('添加失败');                }                $result['msg'] = '操作成功';                $result['success'] = true;                $result['url'] = url('company/index');                Db::commit();                return json($result);            } catch (\Exception $e) {                Db::rollback();                return json(['success' => false, 'msg' => $e->getMessage(), 'data' => []]);            }        }        return view('',['category'=>$category]);    }    /**     * 添加     * @return \think\response\Json|\think\response\View     */    public function edit(){        $this->view->engine->layout(true);        $category = EnterCategoryModel::getSelectArray();        if(\think\facade\Request::isPost()){            try {                Db::startTrans();                $data = input('','','trim');                $company = CompanyModel::get($data['id']);                if(empty($company)){                    throw new \think\Exception('商户不存在');                }                $this->validate($data, 'Company');                if(!$company->force()->save( $data)){                    throw new \think\Exception('操作失败');                }                $result['msg'] = '操作成功';                $result['success'] = true;                $result['url'] = url('company/index');                Db::commit();                return json($result);            } catch (\Exception $e) {                Db::rollback();                return json(['success' => false, 'msg' => $e->getMessage(), 'data' => []]);            }        }        return view('',['category'=>$category]);    }    public function status(){        if(\think\facade\Request::isPost()){            try {                Db::startTrans();                $data = input('','');                if(empty($data['id'])){                    throw new \think\Exception('错误请求');                }                if(empty($data['status'])){                    throw new \think\Exception('错误请求');                }                $company = CompanyModel::get($data['id']);                if(empty($company)){                    throw new \think\Exception('商户不存在');                }                if(!$company->force()->save( $data)){                    throw new \think\Exception('操作失败');                }                $result['msg'] = '操作成功';                $result['success'] = true;                $result['url'] = url('company/index');                Db::commit();                return json($result);            } catch (\Exception $e) {                Db::rollback();                return json(['success' => false, 'msg' => $e->getMessage(), 'data' => []]);            }        }    }    /**     * 展示     * @return \think\response\Json|\think\response\View     */    public function detail(){        $this->view->engine->layout(true);        $id = input('id');        try {            if(empty($id)){                throw new \think\Exception('错误请求');            }            $category = EnterCategoryModel::getSelectArray();            $data = CompanyModel::getDetail($id);            return  view('',['data'=>$data,'category'=>$category]);        } catch (\Exception $e) {            $this->view->engine->layout(false);            return  view('layout/message',['msg'=>$e->getMessage()]);        }    }}