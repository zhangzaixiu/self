<?phpnamespace app\admin\controller;use app\admin\model\UserModel;use think\facade\Cookie;use think\facade\Session;class SiteController extends  BaseController{    /**     * @return array|\think\response\View     * 登录     */    public function login()    {        $this->view->engine->layout(false);        if(\think\facade\Request::isAjax()){            try {                $data=input("request.",'','trim');                $this->validate($data, 'User.login');                $user = UserModel::get(['mobile'=>$data['mobile']]);                if(empty($user)){                    throw new \think\Exception("用户不存在");                }                if($user->password!= md5(md5($data['password']))){                    throw new \think\Exception("密码错误");                }                if($user->status ==2){                    throw new \think\Exception("当前用户被冻结");                }                if(isset($data['rember_me'])){                    \cookie('mobile',$user->mobile,2592000);                    \app\common\helper\Cookie::setCookie('password',$data['password'],2592000);                }else{                    cookie('mobile', null);                    cookie('password', null);                }                //不把密码存储到session里                unset($user->password);                //将用户信息记录到session                session('user',$user);                session('userId',$user->id);                //获取跳转到的页面。跳转到第一个菜单页面                $jump = url('/admin/index/index');                return array("success" => 1, "msg" =>'登录成功','data'=>$user,'url'=>$jump);            } catch (\Exception $e) {                return array("success" => 0, "msg" =>$e->getMessage(),'data'=>[]);            }        }        return view('login',['mobile'=>Cookie::get('mobile'),'password'=>\app\common\helper\Cookie::getCookie('password')]);    }    /**     *退出     */    function logout()    {       Session::clear();       $this->redirect(url('/admin/site/login'));    }    function forget(){//        if(\think\facade\Request::isPost()){//            try {//                $postData = input('',null,'trim');////                $vld = $this->validate($postData, 'user.forget');//                if ($vld !== true) {//                    throw new \think\Exception ($vld);//                }////                $msg=findById("user",array("a.mobile"=>$postData['mobile']));////                if($msg['code'] == 0 || empty($msg['data'])){//                    throw new \think\Exception("用户查询失败");//                }////                if($msg["data"]["status"]=='6018003'){//                    throw new \think\Exception("当前用户已被冻结");//                }////                $validate_code = SendCode::checkMobileCode($postData['mobile'],$postData['code']);//                if($validate_code['code'] == 0){//                    throw new \think\Exception ($validate_code['msg']);//                }//                $postData['password'] = md5($postData['password']);//                unset($postData['repassword']);//                unset($postData['code']);//                $postData['id'] = $msg['data']['id'];////                $msg=saveData("user",$postData);////                if($msg["code"] == 0){//                    throw new \think\Exception('修改失败:'.$msg['msg']);//                }//                Cache::rm('sms_code_'.$postData['mobile']);//                return json(array('code'=>1,'msg'=>'修改成功'));//                //事务提交////            }catch (\Exception $e){//                return array('code'=>0,'msg'=>$e->getMessage());//            }//        }        return view();    }}